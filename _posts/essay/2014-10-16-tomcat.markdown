---
layout: post
category: "essay"
title:  "Tomcat启动极慢的问题"
tags: [essay]
---
今天发现有台服务器tomcat启动非常的慢，卡死在deploy步骤非常长的时间。奇怪的是这台机器配置更好，而其他2台测试服没有问题。tomcat版本8.0.8，jdk1.8.0_05。

一开始以为是webapps下项目多，于是删除了其中导致卡顿的一个，然后发现继续卡死在别的目录上。删到就剩项目本身还是如此。

`INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory /opt/apache-tomcat-8.0.8/webapps/docs`

log就聚焦到这一句没注意下文，再仔细一看下面的log：


`INFO [localhost-startStop-1] org.apache.catalina.util.SessionIdGenerator.createSecureRandom Creation of SecureRandom instance for session ID generation using [SHA1PRNG] took [105,208] milliseconds.`

原来真凶是createSecureRandom这个操作，定位了就方便了，看了下stackoverflow如何解决random的方法，大都是屏蔽调用的方式，麻烦。然后突然想到这台服务器的jdk是同事apt装的，版本都不一致，既然其他服能通过jdk的class调用正常，换jdk不就行了？更换之后果然解决。

后记：今天又不正常了，解决方案[here](http://wiki.apache.org/tomcat/HowTo/FasterStartUp)