---
layout: post
category: "java"
title:  "[SimpleJava]-监听器-java同步的基础"
tags: [simplejava]
---
#### 1. 什么是监听器

监听器可以看做是一个有特殊房间的建筑。这个特殊房间同意时间只能容许一个客户（线程）进入。房间里包含一些数据和代码。

![pic1](http://www.programcreek.com/wp-content/uploads/2011/12/Java-Monitor.jpg)

如果一个客户想进入房间，需要先在走廊（EntrySet）上等待。调度器会根据某种规则（比如FIFO）挑一个人进去。如果因为某种原因他被挂起了，则被放入等待房间，在之后重新进入。

![pic2](http://www.programcreek.com/wp-content/uploads/2011/12/java-monitor-associate-with-object.jpg)

简单的说，监听器就是监控线程访问特殊房间的装置。它保证了同一时间只有一个线程访问被保护对象。

#### 2. java怎样实现

JVM中，每个对象和类逻辑上和一个监听器关联。为了实现监听器的互斥能力，一个锁lock（或者叫mutex）和对象关联。在操作系统中这叫做信号量。mutex是一个二元信号量。

声明一个监听器范围意味着数据不能被多个线程访问。java提供了同步块和方法，如果代码在同步块中，它就在监听器的范围内。JVM会在后台自动实现锁。

#### 3. java同步代码中 哪部分是监听器

为了使不同的线程可以协同合作，java提供了wait、notify方法去挂起一个线程，唤醒其他线程。

<pre>
wait(long timeout, int nanos)
wait(long timeout) notified by other threads or notified by timeout. 
notify(all)
</pre>

这些方法只能在同步块、方法中执行。原因是一个方法如果不需要互斥，那么就不需要监听器处理多个线程。